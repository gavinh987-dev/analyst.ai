// lib/ppt-generator.js
import PptxGenJS from 'pptxgenjs';

export async function createPowerPoint(analysis) {
  const pptx = new PptxGenJS();

  // Slide 1: Title
  const titleSlide = pptx.addSlide();
  titleSlide.addText(analysis.presentation_title || 'Financial Analysis', {
    x: 1,
    y: 1,
    w: 8,         // inches
    h: 1.5,
    fontSize: 32,
    bold: true,
    color: '2D5F8B',
  });
  titleSlide.addText('Generated by Analyst.ai', {
    x: 1,
    y: 2.7,
    fontSize: 14,
    color: '666666',
  });

  // Slide 2: Executive Summary
  const summarySlide = pptx.addSlide();
  summarySlide.addText('Executive Summary', { x: 0.5, y: 0.5, fontSize: 24, bold: true });

  (analysis.executive_summary || []).forEach((point, i) => {
    summarySlide.addText(`• ${point}`, {
      x: 0.5,
      y: 1.2 + i * 0.5,
      fontSize: 16,
      bullet: true,
    });
  });

  // Additional slides
  (analysis.slides || []).forEach((slideData = {}) => {
    const slide = pptx.addSlide();
    slide.addText(slideData.title || 'Slide', { x: 0.5, y: 0.5, fontSize: 24, bold: true });

    (slideData.content || []).forEach((bullet, i) => {
      slide.addText(`• ${bullet}`, {
        x: 0.5,
        y: 1.2 + i * 0.5,
        fontSize: 16,
        bullet: true,
      });
    });
  });

  // Return PPTX Buffer for Node
  return await pptx.write('nodebuffer');
}
