import PptxGenJS from 'pptxgenjs';

export async function createPowerPoint(analysis) {
  const pptx = new PptxGenJS();
  
  // Slide 1: Title Slide
  const titleSlide = pptx.addSlide();
  titleSlide.addText(analysis.presentation_title, { 
    x: 1, y: 1, w: '80%', h: 2, 
    fontSize: 32, bold: true, color: '2D5F8B' 
  });
  titleSlide.addText('Generated by Analyst.ai', {
    x: 1, y: 3, fontSize: 14, color: '666666'
  });

  // Slide 2: Executive Summary
  const summarySlide = pptx.addSlide();
  summarySlide.addText('Executive Summary', { 
    x: 0.5, y: 0.5, fontSize: 24, bold: true 
  });
  
  analysis.executive_summary.forEach((point, index) => {
    summarySlide.addText(`• ${point}`, {
      x: 0.5, y: 1.5 + (index * 0.6),
      fontSize: 16,
      bullet: true
    });
  });

  // Add remaining slides from analysis
  analysis.slides.forEach(slideData => {
    const slide = pptx.addSlide();
    slide.addText(slideData.title, { 
      x: 0.5, y: 0.5, fontSize: 24, bold: true 
    });
    
    slideData.content.forEach((bullet, index) => {
      slide.addText(`• ${bullet}`, {
        x: 0.5, y: 1.5 + (index * 0.6),
        fontSize: 16,
        bullet: true
      });
    });
  });

  // Return the PowerPoint as a buffer
  return await pptx.write('nodebuffer');
}
